# 完整部署和测试指南

## 🚀 基于样本匹配的健康分析系统

本系统使用OCR识别 + 样本匹配的方式，无需LLM API调用，成本更低，响应更快。

## 🔧 部署步骤

### 1. 配置API密钥

1. **获取腾讯云OCR API密钥**：
   - 访问：https://console.cloud.tencent.com/cam/capi
   - 创建SecretId和SecretKey

2. **配置环境变量**：
   - 在云开发控制台配置 `TENCENT_SECRET_ID` 和 `TENCENT_SECRET_KEY`
   - 或修改 `cloudfunctions/analyzeReport/config.json`

### 2. 部署云函数

1. **在微信开发者工具中**：
   - 右键点击 `cloudfunctions/analyzeReport` 文件夹
   - 选择 **"上传并部署：云端安装依赖"**
   - 等待部署完成

2. **测试**：
   - 上传一张体检报告图片
   - 查看控制台日志
   - 应该看到"样本匹配分析完成"

## 📊 系统架构

### ✅ 核心功能
- OCR文字识别（腾讯云）
- 关键指标提取（血压、血糖、胆固醇等）
- 最近邻样本匹配（20个预设样本）
- 智能异常检测（基于参考范围）
- 个性化健康建议

### 🔄 分析流程
```
用户上传图片 → OCR识别 → 提取指标 → 样本匹配 → 生成分析结果
```

## 🧪 测试步骤

1. **上传体检报告图片**
2. **查看控制台日志**，应该看到：
   - "样本匹配分析完成"
   - "找到最相似样本: xxx 相似度: xx%"
3. **检查分析结果**，应该显示：
   - 关键指标（基于OCR提取）
   - 异常项（基于参考范围判断）
   - 综合建议（基于匹配样本）

## ⚠️ 故障排除

### 如果OCR识别失败：
1. 检查腾讯云API密钥配置
2. 确认图片清晰度
3. 查看云函数执行日志

### 如果样本匹配失败：
1. 检查提取的指标是否有效
2. 查看样本数据库是否正确加载
3. 确认指标格式是否正确

## 🎯 预期结果

部署成功后，您应该看到：
- ✅ OCR识别成功
- ✅ 指标提取完成
- ✅ 样本匹配成功
- ✅ 分析结果正常显示

## 📝 优势特点

- **成本低**：无需LLM API调用
- **速度快**：本地样本匹配，响应迅速
- **可控性强**：基于预设样本，结果可预测
- **可扩展**：可轻松添加更多样本数据
