# 🚀 真实LLM分析配置指南

## ✅ 已完成的更新
- 云函数已更新支持真实LLM分析
- 包含OCR文字识别功能
- 包含Google Gemini LLM分析
- 智能回退机制（API失败时使用模拟分析）

## 🔑 配置API密钥

### 1. 获取Google Gemini API密钥
1. 访问：https://makersuite.google.com/app/apikey
2. 登录Google账号
3. 点击"Create API Key"
4. 复制生成的API密钥

### 2. 获取腾讯云OCR API密钥
1. 访问：https://console.cloud.tencent.com/cam/capi
2. 登录腾讯云控制台
3. 点击"新建密钥"
4. 复制SecretId和SecretKey

### 3. 在云开发控制台配置环境变量
1. 打开微信开发者工具
2. 点击"云开发"按钮
3. 进入"云函数"页面
4. 找到"analyzeReport"函数
5. 点击"环境变量"标签
6. 添加以下环境变量：
   - `GEMINI_API_KEY`: 你的Gemini API密钥
   - `TENCENT_SECRET_ID`: 你的腾讯云SecretId
   - `TENCENT_SECRET_KEY`: 你的腾讯云SecretKey

## 🚀 部署步骤

### 步骤1：重新部署云函数
1. 在微信开发者工具中：
   - 右键点击 `cloudfunctions/analyzeReport` 文件夹
   - 选择 **"上传并部署：云端安装依赖"**
   - 等待部署完成

### 步骤2：测试功能
1. 上传一张体检报告图片
2. 查看控制台日志
3. 应该看到 "真实LLM分析完成"

## 📊 功能特点

### 🧠 真实LLM分析
- **OCR识别**：腾讯云OCR识别图片中的文字
- **LLM分析**：Google Gemini分析报告内容
- **智能解析**：提取关键指标、判断异常项
- **个性化建议**：基于实际内容的健康建议

### 🔄 智能回退机制
```
1. 检查API密钥配置
   ↓ 有密钥
2. 执行真实LLM分析
   ↓ 失败
3. 回退到智能模拟分析
   ↓ 失败
4. 使用备用云函数
```

### 📈 分析流程
```
上传图片
    ↓
下载图片文件
    ↓
腾讯云OCR识别文字
    ↓
Google Gemini分析内容
    ↓
返回结构化分析结果
```

## 🎯 预期结果

配置完成后，您应该看到：
- ✅ 真实的OCR文字识别
- ✅ 基于实际内容的LLM分析
- ✅ 更准确的分析结果
- ✅ 个性化的健康建议

## ⚠️ 注意事项

1. **API费用**：真实LLM分析会产生API调用费用
2. **API配额**：注意API调用次数限制
3. **网络延迟**：真实分析需要更多时间
4. **错误处理**：完善的回退机制确保功能可用

## 🧪 测试方法

1. **无API密钥**：应该使用智能模拟分析
2. **有API密钥**：应该使用真实LLM分析
3. **API失败**：应该自动回退到模拟分析

现在请按照步骤配置API密钥并重新部署云函数！
